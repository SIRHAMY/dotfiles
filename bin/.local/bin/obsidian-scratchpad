#!/usr/bin/env bash
# Cycle Obsidian scratchpad: hidden → left half → right half → hidden

STATE_FILE="/tmp/obsidian-scratchpad-state"

# Check if obsidian is running at all
if ! swaymsg -t get_tree | grep -q '"class": "obsidian"'; then
    flatpak run md.obsidian.Obsidian &
    echo "launching" > "$STATE_FILE"
    exit 0
fi

# Read last state
state=$(cat "$STATE_FILE" 2>/dev/null || echo "hidden")

case "$state" in
    hidden|launching)
        # Show from scratchpad and snap to left half
        swaymsg '[class=obsidian] scratchpad show, resize set 50 ppt 100 ppt, move position 0 0'
        echo "left" > "$STATE_FILE"
        ;;
    left)
        # Move to right half
        swaymsg '[class=obsidian] resize set 50 ppt 100 ppt, move position 50 ppt 0'
        echo "right" > "$STATE_FILE"
        ;;
    right)
        # Hide back to scratchpad
        swaymsg '[class=obsidian] move scratchpad'
        echo "hidden" > "$STATE_FILE"
        ;;
esac
